<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notas - Real Madrid CF</title>
    
    <link rel="stylesheet" href="styles.css">
    
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" type="image/png" href="./favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/180px-Real_Madrid_CF.svg.png">

    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>    
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0" defer></script>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js" defer></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js" defer></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css"/>
    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js" defer></script>
</head>
<body class="bg-gray-100 min-h-screen">
    
    <!-- WELCOME SCREEN -->
    <section id="section-welcome" class="welcome-bg min-h-screen flex flex-col items-center justify-center p-4 text-white">
        <div class="text-center mb-10">
            <img src="https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/1200px-Real_Madrid_CF.svg.png" 
                 alt="Real Madrid" class="w-24 h-24 object-contain mx-auto mb-4 drop-shadow-2xl">
            <h1 class="text-3xl md:text-5xl font-bold mb-2 drop-shadow-md">Notas Real Madrid</h1>
            <p class="text-blue-100 font-medium text-lg drop-shadow-md">Temporada 2025/2026</p>
            
            <!-- STORAGE MODE TOGGLE -->
            <div class="mt-6 bg-white/10 backdrop-blur-md p-1 rounded-lg inline-flex">
                <button onclick="setStorageMode('local')" id="btn-mode-local" class="px-4 py-2 rounded-md font-bold bg-white text-slate-900 shadow-sm transition-all text-sm">üì± Local</button>
                <button onclick="setStorageMode('global')" id="btn-mode-global" class="px-4 py-2 rounded-md font-bold text-white hover:bg-white/10 transition-all text-sm">‚òÅÔ∏è Global (Nube)</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl">
            <!-- MASCULINO -->
            <div onclick="selectTeam('masculino')" class="welcome-card bg-white/10 backdrop-blur-sm text-white rounded-2xl p-8 text-center shadow-2xl border-b-8 border-blue-600 hover:bg-white/20 transition-all">
                <h2 class="text-2xl font-bold mb-2">Real Madrid Masculino</h2>
                <p class="text-black-200 font-semibold">Temporada 2025/2026</p>
                <p class="text-sm text-black-300 mt-2">La Liga, Champions, Copa del Rey...</p>
            </div>

            <!-- FEMENINO -->
            <div onclick="selectTeam('femenino')" class="welcome-card bg-white/10 backdrop-blur-sm text-white rounded-2xl p-8 text-center shadow-2xl border-b-8 border-purple-500 hover:bg-white/20 transition-all">
                <h2 class="text-2xl font-bold mb-2">Real Madrid Femenino</h2>
                <p class="text-black-200 font-semibold">Temporada 2025/2026</p>
                <p class="text-sm text-black-300 mt-2">Liga F, UWCL, Copa de la Reina...</p>
            </div>
        </div>
    </section>
    <!-- APP CONTAINER (Hidden initially) -->
    <div id="app-container" class="hidden bg-gray-100">
        <!-- Header Real Madrid -->
        <header class="rm-header-gradient text-white shadow-lg">


            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition" onclick="returnToWelcome()" title="Volver a selecci√≥n de equipo">
                        <img src="https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/1200px-Real_Madrid_CF.svg.png" 
                             alt="Real Madrid" class="w-12 h-12 object-contain" loading="lazy">
                        <div>
                            <h1 class="text-2xl font-bold">An√°lisis Real Madrid</h1>
                            <p id="header-subtitle" class="text-blue-200 text-sm">Real Madrid CF</p>
                        </div>
                    </div>

                    <!-- MATCHDAY BANNER (Desktop) -->
                    <div id="matchday-banner-desktop" class="hidden md:flex items-center gap-4 bg-white/10 px-4 py-2 rounded-lg border border-white/10 backdrop-blur-sm animate-pulse">
                        <span class="text-2xl">‚öΩ</span>
                        <div class="text-right">
                            <div class="text-xs font-bold text-amber-400 uppercase tracking-widest">D√çA DE PARTIDO</div>
                            <div class="font-bold text-sm leading-none text-white" id="matchday-desktop-text">vs Rival</div>
                            <div class="text-[10px] text-blue-200" id="matchday-desktop-info">21:00 ‚Ä¢ Liga</div>
                        </div>
                    </div>

                    <button onclick="toggleDarkMode()" id="btn-dark-mode" class="p-2 rounded-full bg-white/10 hover:bg-white/20 transition backdrop-blur-sm" title="Cambiar Tema">
                        üåô
                    </button>
                    <button id="btn-tour" class="ml-2 p-2 rounded-full bg-white/10 hover:bg-white/20 transition backdrop-blur-sm" title="Iniciar Tour Guiado">
                        üéì
                    </button>
                    <button id="btn-auth" class="ml-2 p-2 rounded-full bg-white/10 hover:bg-white/20 transition backdrop-blur-sm text-xs font-bold" title="Iniciar Sesi√≥n">
                        üîí
                    </button>
                </div>

                <!-- MATCHDAY BANNER (Mobile) -->
                <div id="matchday-banner-mobile" class="md:hidden hidden mt-4 bg-gradient-to-r from-amber-600 to-orange-600 rounded-lg p-3 shadow-lg flex items-center justify-between animate-in slide-in-from-top-2">
                    <div class="flex items-center gap-3">
                        <div class="bg-white/20 p-2 rounded-full">‚öΩ</div>
                        <div>
                            <div class="text-[10px] font-black text-amber-100 uppercase tracking-widest">HOY JUEGA EL MADRID</div>
                            <div class="font-bold text-sm text-white" id="matchday-mobile-text">vs Rival</div>
                        </div>
                    </div>
                    <div class="text-right text-xs text-white font-mono bg-black/20 px-2 py-1 rounded" id="matchday-mobile-time">
                        21:00
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-slate-800 shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-4">
                <div class="flex gap-1 overflow-x-auto">
                    <button onclick="showTab('principal')" id="tab-principal" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap">
                        üè† Principal
                    </button>
                    <button onclick="showTab('plantilla')" id="tab-plantilla" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap tab-active">
                        üë• Plantilla
                    </button>
                    <button onclick="showTab('calendario')" id="tab-calendario" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap">
                        üìÖ Calendario
                    </button>
                    <button onclick="showTab('nuevo')" id="tab-nuevo" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap">
                        ‚ûï Registrar Partido
                    </button>
                    <button onclick="showTab('partidos')" id="tab-partidos" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap">
                        ‚öΩ Partidos
                    </button>
                    <button onclick="showTab('stats')" id="tab-stats" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap">
                        üìä Estad√≠sticas
                    </button>
                    <button onclick="showTab('comparador')" id="tab-comparador" class="tab-btn px-4 py-3 font-medium text-gray-300 hover:text-amber-400 whitespace-nowrap">
                        üÜö Comparador
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!--Men√∫ principal-->
            <section id="section-principal" class="hidden fade-in">
                <div class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Panel General</h2>
                        <p class="text-gray-500 text-sm">Resumen de la temporada actual</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleDashboardEditMode()" id="btn-edit-dashboard" class="bg-white text-gray-600 border border-gray-300 hover:bg-gray-50 font-bold py-2 px-4 rounded-lg shadow-sm flex items-center gap-2 transition-all text-sm">
                            <span>‚úèÔ∏è</span> Editar Panel
                        </button>
                    </div>
                    <button onclick="showCrystalBall()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-2 px-4 rounded-lg shadow-md flex items-center gap-2 transition-all transform hover:scale-105 text-sm">
                        <span>üîÆ</span> Bola de Cristal
                    </button>
                </div>
                <div id="club-trophies-container" class="hidden fade-in"></div>
                <div id="competition-status" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"></div>
                <div id="dashboard-widgets-area" class="space-y-6">
                <div id="widget-top-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" draggable="false">
                    
                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-slate-800 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-slate-800 text-6xl">üìÖ</div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Pr√≥ximo Partido</h3>
                        <div id="dashboard-next-match">
                            <p class="text-gray-500 text-sm">Cargando...</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-amber-400 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-amber-500 text-6xl">üî•</div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Estado de Forma (√öltimos 5)</h3>
                        <div id="dashboard-form" class="flex items-center gap-2 mt-2">
                            <span class="text-gray-500 text-sm">Sin datos</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-600 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-blue-600 text-6xl">üìä</div>
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Resumen Temporada</h3>
                        <div id="dashboard-summary" class="flex justify-between items-end mt-2">
                             <div class="text-center">
                                <span class="block text-2xl font-bold text-green-600" id="dash-wins">0</span>
                                <span class="text-xs text-gray-500">Vic</span>
                             </div>
                             <div class="text-center">
                                <span class="block text-2xl font-bold text-amber-600" id="dash-draws">0</span>
                                <span class="text-xs text-gray-500">Emp</span>
                             </div>
                             <div class="text-center">
                                <span class="block text-2xl font-bold text-red-600" id="dash-losses">0</span>
                                <span class="text-xs text-gray-500">Der</span>
                             </div>
                             <div class="w-px h-8 bg-gray-200 mx-1"></div>
                             <div class="text-center">
                                <span class="block text-xl font-bold text-slate-700" id="dash-gf">0</span>
                                <span class="text-xs text-gray-500">GF</span>
                             </div>
                             <div class="text-center">
                                <span class="block text-xl font-bold text-slate-700" id="dash-ga">0</span>
                                <span class="text-xs text-gray-500">GC</span>
                             </div>
                        </div>
                    </div>
                </div> <!-- End Top Stats -->
                  <div id="ai-prediction-card" class="hidden bg-gradient-to-r from-violet-600 to-indigo-600 rounded-xl shadow-lg p-1 text-white relative overflow-hidden" draggable="false">
                    <div class="absolute top-0 right-0 p-8 opacity-10 text-9xl">ü§ñ</div>
                    
                    <div class="bg-slate-900/40 backdrop-blur-md rounded-lg p-5">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
                            
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="bg-violet-500 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider shadow-sm border border-violet-400">AI Analysis</span>
                                    <span class="text-violet-200 text-xs font-mono" id="ai-match-label">Analizando datos...</span>
                                </div>
                                <h3 class="text-2xl font-bold text-white mb-1 flex items-center gap-2">
                                    <span id="ai-prediction-text">Calculando probabilidades...</span>
                                </h3>
                                <p class="text-indigo-200 text-sm" id="ai-reasoning">Procesando racha y estad√≠sticas...</p>
                            </div>

                            <div class="w-full md:w-auto flex flex-col gap-2 min-w-[200px]">
                                <div class="flex justify-between text-xs font-bold text-indigo-100 uppercase tracking-widest">
                                    <span>Probabilidad de Victoria</span>
                                    <span id="ai-win-prob">--%</span>
                                </div>
                                <div class="w-full h-3 bg-slate-700/50 rounded-full overflow-hidden flex">
                                    <div id="prob-bar-win" class="h-full bg-green-400 shadow-[0_0_10px_rgba(74,222,128,0.5)] transition-all duration-1000" style="width: 0%"></div>
                                    <div id="prob-bar-draw" class="h-full bg-yellow-400 opacity-80 transition-all duration-1000" style="width: 0%"></div>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-1">
                                    <span class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-green-400"></div> Victoria</span>
                                    <span class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-yellow-400"></div> Empate</span>
                                    <span class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-slate-600"></div> Derrota</span>
                                </div>
                            </div>

                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 border-t border-white/10 pt-4">
                            <div class="flex items-center gap-3">
                                <div class="text-3xl">üîÆ</div>
                                <div>
                                    <p class="text-[10px] uppercase text-indigo-300 font-bold">Marcador Probable</p>
                                    <p class="text-xl font-bold text-white" id="ai-score-prediction">-</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-3">
                                <div class="text-3xl">üî•</div>
                                <div>
                                    <p class="text-[10px] uppercase text-indigo-300 font-bold">Jugador a Seguir</p>
                                    <p class="text-sm font-bold text-white" id="ai-player-watch">-</p>
                                    <p class="text-[10px] text-indigo-200" id="ai-player-reason">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              <div id="widget-semaforo" class="" draggable="false">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                      üö¶ Sem√°foro de Forma <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">√öltimos 3 partidos</span>
              </h3>

               <div id="semaforo-content" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <p class="text-center text-gray-400 py-4 col-span-3">Cargando datos...</p>
            </div>

          <div id="semaforo-expand-btn-container" class="hidden text-center">
            <button onclick="toggleTrafficAll()" id="btn-traffic-all" 
                class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold rounded-full text-sm transition-all shadow-sm border border-gray-200">
               Ver todos los jugadores ‚ñº
                       </button>
                        </div>
            </div> <!-- End Semaforo -->
            <div id="top-performances-container" class="animate-fade-in hidden" draggable="false">
    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
        <span>üåü</span> Actuaciones Legendarias (Top 5)
    </h3>
    <div id="top-performances-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
        </div>
    </div> <!-- End Top Perf -->
                <div id="widget-bottom-stats" class="grid grid-cols-1 lg:grid-cols-3 gap-6" draggable="false">
                    
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-5 py-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                             <h3 class="font-bold text-gray-700">√öltimos Resultados</h3>
                             <button onclick="showTab('partidos')" class="text-xs text-blue-600 hover:underline">Ver todos</button>
                        </div>
                        <div id="dashboard-last-results" class="divide-y divide-gray-100">
                             </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-5 py-4 border-b border-gray-100 bg-gray-50">
                             <h3 class="font-bold text-gray-700">L√≠deres</h3>
                        </div>
                        <div id="dashboard-leaders" class="p-4 space-y-4">
                             </div>
                    </div>

                </div> <!-- End Bottom Stats -->
                </div> <!-- End Dashboard Widgets Area -->
                <div class="mt-8 bg-white rounded-xl shadow-sm p-6 border border-gray-200" id="widget-data-management">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        üíæ Gesti√≥n de Datos
                    </h3>
                    <p class="text-sm text-gray-500 mb-4">
                        Guarda una copia de seguridad de toda tu temporada o restaura un archivo guardado anteriormente. 
                        <span class="text-amber-600 font-bold">¬°Haz esto frecuentemente para no perder datos!</span>
                    </p>
                    
                   <div class="flex flex-col sm:flex-row gap-4">
                        <button onclick="backupData()" class="flex-1 bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 px-4 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all">
                            ‚¨áÔ∏è Descargar Copia
                        </button>

                        <div class="flex-1 relative">
                            <input type="file" id="import-file" accept=".json" class="hidden" onchange="restoreData(this)">
                            <button onclick="document.getElementById('import-file').click()" class="w-full bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 px-4 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all">
                                ‚¨ÜÔ∏è Restaurar Datos
                            </button>
                        </div>

                       <div class="flex-1 relative flex gap-2">
                            <input type="file" id="import-csv" accept=".csv" class="hidden" onchange="importFromCSV(this)">
                            
                            <button onclick="document.getElementById('import-csv').click()" class="flex-1 bg-orange-50 hover:bg-orange-100 text-orange-700 border border-orange-200 px-4 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all">
                                üìä Importar Excel (CSV)
                            </button>

                            <button onclick="toggleCSVInfo()" class="w-12 flex items-center justify-center bg-white border border-gray-200 rounded-xl hover:bg-gray-50 transition-all shadow-sm" title="Ver formato requerido">
                                <img src="https://cdn-icons-png.flaticon.com/512/8/8201.png" alt="Info" class="w-6 h-6 opacity-70" loading="lazy">
                            </button>

                            <div id="csv-info-modal" class="hidden absolute bottom-full right-0 mb-2 w-80 md:w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 p-0 overflow-hidden animate-in fade-in zoom-in duration-200">
                                <div class="bg-slate-800 text-white p-3 flex justify-between items-center">
                                    <h4 class="font-bold text-sm">üìÑ Formato Requerido para Excel</h4>
                                    <button onclick="toggleCSVInfo()" class="text-gray-400 hover:text-white">‚úï</button>
                                </div>
                                <div class="p-4 text-sm text-gray-600">
                                    <p class="mb-3">Para que la importaci√≥n funcione correctamente y detecte las fechas, usa esta estructura:</p>
                                    
                                    <div class="border border-gray-300 rounded overflow-hidden mb-3">
                                        <table class="w-full text-xs text-center">
                                            <tr class="bg-gray-100 font-bold border-b border-gray-300">
                                                <td class="p-1 border-r"></td>
                                                <td class="p-1 border-r text-blue-600">Rival A</td>
                                                <td class="p-1 text-blue-600">Rival B</td>
                                            </tr>
                                            <tr class="bg-yellow-50 border-b border-gray-300 font-mono text-[10px]">
                                                <td class="p-1 border-r font-bold text-gray-400">FECHA -></td>
                                                <td class="p-1 border-r text-orange-600 font-bold">26/10/2024</td>
                                                <td class="p-1 text-orange-600 font-bold">03/11/2024</td>
                                            </tr>
                                            <tr class="border-b border-gray-100">
                                                <td class="p-1 border-r font-bold text-left pl-2">Mbapp√©</td>
                                                <td class="p-1 border-r">8,5</td>
                                                <td class="p-1">7</td>
                                            </tr>
                                            <tr>
                                                <td class="p-1 border-r font-bold text-left pl-2">Vini Jr</td>
                                                <td class="p-1 border-r">9</td>
                                                <td class="p-1">6,5</td>
                                            </tr>
                                        </table>
                                    </div>

                                    <ul class="list-disc list-inside text-xs space-y-1 text-gray-500">
                                        <li><b>Fila 1:</b> Nombres de los Rivales.</li>
                                        <li><b>Fila 2:</b> Fechas (DD/MM/AAAA) <span class="text-orange-600 font-bold">*Importante</span>.</li>
                                        <li><b>Columna A:</b> Nombres de los Jugadores.</li>
                                        <li>Guarda el archivo como <b>CSV (delimitado por comas o punto y coma)</b>.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-gray-100 text-right">
                        <button onclick="hardReset()" class="text-xs text-red-400 hover:text-red-600 underline">
                            Borrar todo y empezar de cero
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- PLANTILLA SECTION -->
            <section id="section-plantilla" class="fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Plantilla</h2>
                        <p class="text-gray-500 text-sm">Gesti√≥n de estado de jugadores</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="filterPlayers('all')" id="filter-all" class="px-3 py-1.5 text-sm bg-slate-800 text-white rounded-lg">
                            Todos
                        </button>
                        <button onclick="filterPlayers('active')" id="filter-active" class="px-3 py-1.5 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                            Activos
                        </button>
                        <button onclick="filterPlayers('inactive')" id="filter-inactive" class="px-3 py-1.5 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                            Inactivos
                        </button>
                        <button onclick="filterPlayers('loaned')" id="filter-loaned" class="px-3 py-1.5 text-sm bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                            Cedidos
                        </button>
                    </div>
                </div>
                <div class="mb-4 relative">
    <input type="text" id="player-search" placeholder="üîç Buscar jugador por nombre o dorsal..." 
           class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 outline-none transition-all"
           onkeyup="renderPlayers()">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
    </div>
    </div>
                <!-- Filter by Position -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-4">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterByPosition('')" class="pos-filter px-3 py-1 text-sm rounded-full bg-slate-800 text-white">Todas</button>
                        <button onclick="filterByPosition('entrenador')" class="pos-filter px-3 py-1 text-sm rounded-full bg-gray-200 hover:bg-slate-300 font-bold border border-slate-400">Entrenador</button>
                        <button onclick="filterByPosition('portero')" class="pos-filter px-3 py-1 text-sm rounded-full bg-gray-200 hover:bg-amber-100">Porter√≠a</button>
                        <button onclick="filterByPosition('defensa')" class="pos-filter px-3 py-1 text-sm rounded-full bg-gray-200 hover:bg-blue-100">Defensa</button>
                        <button onclick="filterByPosition('centrocampista')" class="pos-filter px-3 py-1 text-sm rounded-full bg-gray-200 hover:bg-green-100">Medio</button>
                        <button onclick="filterByPosition('extremo')" class="pos-filter px-3 py-1 text-sm rounded-full bg-gray-200 hover:bg-purple-100">Extremo</button>
                        <button onclick="filterByPosition('delantero')" class="pos-filter px-3 py-1 text-sm rounded-full bg-gray-200 hover:bg-red-100">Delantera</button>
                    </div>
                </div>
                
                <div id="players-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                </div>
            </section>

            <!-- CALENDARIO SECTION -->
            <section id="section-calendario" class="hidden fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Calendario Oficial</h2>
                        <p class="text-gray-500 text-sm">Haz clic en partidos pasados para registrar estad√≠sticas</p>
                    </div>
                    <div class="flex gap-2">
                        <div class="bg-white rounded-lg p-1 border flex">
                            <button onclick="switchCalendarView('list')" id="cal-view-list" class="px-3 py-1.5 text-sm rounded-md font-medium transition text-gray-600 hover:bg-gray-100">
                                üìÉ Lista
                            </button>
                            <button onclick="switchCalendarView('month')" id="cal-view-month" class="px-3 py-1.5 text-sm rounded-md font-medium transition bg-slate-800 text-white">
                                üóìÔ∏è Mes
                            </button>
                        </div>
                        <button onclick="loadCalendar()" class="bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                            üîÑ Actualizar
                        </button>
                    </div>
                </div>

                <!-- Calendar Select Hint -->
                <div class="calendar-select-hint rounded-xl p-4 mb-4 flex justify-between items-center">
                    <p class="text-sm">
                        <strong>üí° Consejo:</strong> Los partidos marcados en gris ya han sido registrados.
                    </p>
                    <label class="flex items-center gap-2 text-sm font-medium cursor-pointer">
                        <input type="checkbox" id="hide-registered-matches" onchange="renderCalendar()" class="w-4 h-4 text-slate-800">
                        Ocultar registrados
                    </label>
                </div>
                
                <!-- Competition Filters -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-4">
                    <div id="calendar-filters-container" class="flex flex-wrap gap-2">
                        <!-- Filters populated dynamically -->
                    </div>
                </div>

                <!-- Time Filter (Only for list view) -->
                <div id="cal-time-filters" class="hidden bg-white rounded-xl shadow-sm p-4 mb-4">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="filterCalendarTime('all')" class="time-filter px-3 py-1 text-sm rounded-full bg-slate-800 text-white">Todos</button>
                        <button onclick="filterCalendarTime('past')" class="time-filter px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700">Pasados</button>
                        <button onclick="filterCalendarTime('future')" class="time-filter px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700">Pr√≥ximos</button>
                    </div>
                </div>
                
                <!-- Month Navigation (Only for month view) -->
                <div id="cal-month-nav" class="bg-white rounded-xl shadow-sm p-4 mb-4 flex justify-between items-center">
                    <button onclick="changeCalendarMonth(-1)" class="p-2 hover:bg-gray-100 rounded-full">‚¨ÖÔ∏è Anterior</button>
                    <h3 id="current-month-display" class="text-lg font-bold text-slate-800"></h3>
                    <button onclick="changeCalendarMonth(1)" class="p-2 hover:bg-gray-100 rounded-full">Siguiente ‚û°Ô∏è</button>
                </div>
                
                <div id="calendar-container" class="space-y-3">
                    <div class="calendar-loading text-center py-12">
                        <div class="text-4xl mb-4">‚è≥</div>
                        <p class="text-gray-600">Cargando calendario...</p>
                    </div>
                </div>
            </section>

            <!-- NUEVO PARTIDO SECTION -->
            <section id="section-nuevo" class="hidden fade-in">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Registrar Nuevo Partido</h2>
                    <p class="text-gray-500 text-sm">Registro en 2 pasos: Datos y Jugadores</p>
                </div>
                
                <!-- Prompt to select from Calendar -->
                <div id="select-match-prompt" class="text-center py-12 bg-white rounded-xl shadow-sm">
                    <div class="text-6xl mb-4">üìÖ</div>
                    <h3 class="text-xl font-medium text-gray-800 mb-2">Selecciona un partido del calendario</h3>
                    <p class="text-gray-500 mb-6 max-w-md mx-auto">Para garantizar la integridad de los datos, todos los partidos deben ser seleccionados primero desde la secci√≥n de Calendario.</p>
                    <button onclick="showTab('calendario')" class="bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-lg font-medium transition">
                        Ir al Calendario
                    </button>
                </div>

                <div id="new-match-form-container" class="hidden">
                    <!-- Selected Fixture Info -->
                    <div id="selected-fixture-info" class="bg-amber-50 border-2 border-amber-400 rounded-xl p-4 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-amber-800 font-medium">üìÖ Partido seleccionado del calendario:</p>
                                <p id="selected-fixture-details" class="text-amber-900 font-semibold"></p>
                            </div>
                            <button onclick="clearSelectedFixture()" class="text-amber-600 hover:text-amber-800 text-sm font-medium">
                                ‚úï Cancelar selecci√≥n
                            </button>
                        </div>
                    </div>

                    <!-- New Match Form -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <form id="new-match-form" class="space-y-6">
                            <input type="hidden" id="calendar-event-id" value="">
                            
                            <div id="wizard-step-1">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 pb-2 border-b">Paso 1: Datos del Partido</h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Competici√≥n *</label>
                                        <select id="new-competition" required onchange="updateRoundOptions()" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 bg-white">
                                            <option value="">Seleccionar competici√≥n...</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Jornada / Ronda *</label>
                                        <select id="new-round" required onchange="handleRoundChange()" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 bg-white">
                                            <option value="">Primero selecciona competici√≥n...</option>
                                        </select>
                                        <p id="round-info" class="text-xs text-gray-500 mt-1"></p>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Rival *</label>
                                        <input type="text" id="new-opponent" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 bg-gray-100" readonly>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Fecha *</label>
                                        <input type="date" id="new-date" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div id="stadium-container">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Estadio / Condici√≥n</label>
                                        <div class="flex gap-2">
                                            <select id="new-venue" class="w-1/3 px-2 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 bg-white" onchange="updateStadiumField()">
                                                <option value="local">üè† Local</option>
                                                <option value="visitante">‚úàÔ∏è Visitante</option>
                                                <option value="neutral">‚öñÔ∏è Neutral</option>
                                            </select>
                                            <input type="text" id="new-stadium" class="w-2/3 px-3 py-2 border rounded-lg bg-gray-100" value="Santiago Bernab√©u" readonly>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Resultado (Goles) *</label>
                                        <input type="text" id="new-result" required oninput="updateOvertimeOptions()" placeholder="Ej: 2-1" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500 font-bold text-lg text-center tracking-widest" pattern="^\d+-\d+$">
                                        <p class="text-xs text-gray-500 mt-1 text-center">Formato: local-visitante (ej: 3-1)</p>
                                    </div>
                                </div>
                                
                                <div id="overtime-controls" class="hidden mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                                    <h4 class="font-bold text-orange-800 mb-2 text-sm">Desenlace Eliminatoria</h4>
                                    
                                    <div id="extra-time-option" class="mb-2 hidden">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="chk-extra-time" class="w-4 h-4 text-orange-600">
                                            <span class="text-sm font-medium text-gray-700">Pr√≥rroga jugada</span>
                                        </label>
                                    </div>
                                    
                                    <div id="penalties-option" class="hidden">
                                        <label class="flex items-center gap-2 cursor-pointer mb-2">
                                            <input type="checkbox" id="chk-penalties" class="w-4 h-4 text-orange-600" onchange="togglePenaltyWinner()">
                                            <span class="text-sm font-medium text-gray-700">Tanda de Penaltis</span>
                                        </label>
                                        <div id="penalty-winner-select" class="hidden ml-6">
                                            <p class="text-xs text-gray-500 mb-1">Resultado de la tanda:</p>
                                            <div class="flex gap-4">
                                                <label class="flex items-center gap-1 cursor-pointer">
                                                    <input type="radio" name="penalties-outcome" value="win" class="text-green-600">
                                                    <span class="text-sm text-green-700 font-bold">Victoria</span>
                                                </label>
                                                <label class="flex items-center gap-1 cursor-pointer">
                                                    <input type="radio" name="penalties-outcome" value="loss" class="text-red-600">
                                                    <span class="text-sm text-red-700 font-bold">Derrota</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="leg-indicator" class="hidden p-4 global-result rounded-lg mb-4 mt-4">
                                    <p id="leg-info" class="text-sm text-blue-800"></p>
                                </div>

                                <div id="venue-alternation-warning" class="hidden p-4 bg-amber-50 border border-amber-200 rounded-lg mb-4">
                                    <p id="venue-alternation-info" class="text-sm text-amber-800"></p>
                                </div>
                                
                                <div class="flex justify-end pt-4 border-t">
                                    <button type="button" onclick="goToStep2()" class="px-6 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 font-medium shadow-lg transform active:scale-95 transition-all">
                                        Siguiente: Jugadores ‚û°Ô∏è
                                    </button>
                                </div>
                            </div>

                            <!-- STEP 2: JUGADORES -->
                            <div id="wizard-step-2" class="hidden h-full">
                                <div class="flex flex-col sm:flex-row justify-between items-center mb-2 pb-2 border-b gap-3">
                                    <h3 class="text-lg font-bold text-gray-800">Paso 2: Alineaci√≥n</h3>
                                    
                                    <div class="flex items-center gap-3">
                                        <div class="bg-gray-100 p-1 rounded-lg flex text-sm">
                                            <button type="button" id="btn-mode-list" class="px-3 py-1 text-gray-500 hover:text-gray-700 transition-all" onclick="switchLineupMode('list')">Lista</button>
                                            <button type="button" id="btn-mode-pitch" class="px-3 py-1 bg-white shadow rounded text-gray-800 font-medium transition-all" onclick="switchLineupMode('pitch')">Pizarra</button>
                                        </div>
                                        <button type="button" onclick="goToStep1()" class="text-sm text-blue-600 hover:underline">‚¨ÖÔ∏è Volver</button>
                                    </div>
                                </div>
                                <div class="flex justify-center gap-3 mb-3 mt-1 animate-in fade-in slide-in-from-top-2 no-capture">
    
                                <button type="button" onclick="loadLastLineup()" class="flex items-center gap-1 text-xs font-bold bg-white text-slate-700 px-3 py-1.5 rounded-full border border-slate-200 hover:bg-slate-50 hover:border-slate-300 transition shadow-sm">
                                ‚Ü∫ Repetir √öltimo Once
                                </button>

                                <button type="button" onclick="loadBestXILineup()" class="flex items-center gap-1 text-xs font-bold bg-amber-50 text-amber-700 px-3 py-1.5 rounded-full border border-amber-200 hover:bg-amber-100 hover:border-amber-300 transition shadow-sm">
                                ‚≠ê Cargar Once de Gala
                                </button>

                                <button type="button" onclick="exportLineupToImage()" class="flex items-center gap-1 text-xs font-bold bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full border border-blue-200 hover:bg-blue-100 hover:border-blue-300 transition shadow-sm">
                                üì∏ Foto
                                </button>

                                </div>

                                <div id="mode-list-container" class="hidden">
                                    <div class="mb-2 text-sm text-amber-700 bg-amber-50 p-2 rounded">‚ö†Ô∏è Selecciona "Titular" o "Suplente".</div>
                                    <div id="new-match-players-stats" class="space-y-3 h-[60vh] overflow-y-auto border border-gray-200 rounded-xl p-4 bg-gray-50"></div>
                                </div>

                                <div id="mode-pitch-container" class="flex flex-col h-full">

    <div class="mb-3 flex flex-col md:flex-row items-center justify-between gap-3 bg-white p-2 rounded-xl border border-gray-200 shadow-sm mx-1">
        
        <div class="flex items-center gap-2">
            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Esquema</label>
            <select id="formation-select" class="border-gray-300 rounded text-sm font-bold text-slate-700 focus:ring-indigo-500 focus:border-indigo-500 py-1 cursor-pointer bg-gray-50" onchange="updatePitchFormation()">
                 <option value="4-3-3">4-3-3</option>
                 <option value="4-4-2">4-4-2</option>
                 <option value="4-2-3-1" selected>4-2-3-1</option> 
                 <option value="3-5-2">3-5-2</option>
            </select>
        </div>
    
    <div class="flex items-center gap-3 text-sm">
    
    <div class="flex flex-col items-end leading-tight">
        <span class="text-[10px] text-gray-400 font-bold uppercase">Once Inicial</span>
        <span id="value-starters" class="font-black text-emerald-600">0 M‚Ç¨</span>
    </div>

    <div class="w-px h-6 bg-gray-200"></div> <div class="flex flex-col items-end leading-tight">
        <span class="text-[10px] text-gray-400 font-bold uppercase">Convocatoria</span>
        <span id="value-total" class="font-black text-slate-700">0 M‚Ç¨</span>
    </div>

    <div class="w-px h-6 bg-gray-200"></div> <div class="flex flex-col items-end leading-tight">
        <span class="text-[10px] text-gray-400 font-bold uppercase">Edad Media (XI)</span>
        <span id="value-age" class="font-black text-blue-600">0.0 a√±os</span>
    </div>

    </div>
    
    </div>

    <div id="tactical-board-container" class="flex flex-col md:flex-row gap-4 h-[550px]">

        <div class="flex-1 relative bg-gray-800 rounded-xl border-4 border-gray-800 overflow-hidden shadow-xl">
            <div class="pitch-container w-full h-full" id="tactical-pitch" style="margin: 0; border: none; border-radius: 0;">
                <div class="pitch-line-mid"></div>
                <div class="pitch-circle"></div>
                <div class="pitch-box-left" style="left:0; border-left:none;"></div>
                <div class="pitch-box-right" style="right:0; border-right:none;"></div>
                
                <div id="pitch-slots-layer"></div>
                <div id="pitch-players-layer"></div>
            </div>
        </div>

        <div class="w-full md:w-72 flex flex-col gap-2 h-full">
            
            <div class="flex-1 bg-white rounded-xl border border-gray-300 flex flex-col shadow-sm overflow-hidden">
                <div class="bg-gray-100 p-2 border-b border-gray-200">
                    <h5 class="text-xs font-bold text-gray-600 uppercase text-center">Plantilla Disponible</h5>
                </div>
                <div id="bench-zone" class="bench-container flex-1 overflow-y-auto p-2 bg-gray-50 content-start">
                    </div>
            </div>
            
            <div class="h-32 bg-blue-50 rounded-xl border-2 border-dashed border-blue-300 flex flex-col overflow-hidden">
                <div class="bg-blue-100 p-1 border-b border-blue-200">
                    <h5 class="text-[10px] font-bold text-blue-600 uppercase text-center">Suplentes Convocados</h5>
                </div>
                <div id="subs-zone" class="flex-1 p-2 overflow-y-auto flex flex-wrap gap-2 content-start">
                    </div>
            </div>

        </div>
    </div>
    </div>
                                <div class="flex gap-3 pt-4 border-t mt-4">
                                    <button type="button" onclick="goToStep1()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">Atr√°s</button>
                                    <button type="button" onclick="goToStep3()" class="flex-1 px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 font-bold text-lg shadow-lg flex items-center justify-center gap-2 transform hover:scale-[1.01] transition-all">
                                        CONFIRMAR ALINEACI√ìN ‚û°Ô∏è
                                    </button>
                                </div>
                            </div>
                            <div id="wizard-step-3" class="hidden">
                                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 pb-2 border-b gap-3">
                                    <h3 class="text-lg font-bold text-gray-800">Paso 3: Rendimiento</h3>
                                    <button type="button" onclick="goToStep2()" class="text-sm text-blue-600 hover:underline">‚¨ÖÔ∏è Volver a Pizarra</button>
                                </div>

                                <div class="mb-2 text-sm text-green-700 bg-green-50 p-2 rounded">‚úÖ Alineaci√≥n confirmada. Introduce las estad√≠sticas del partido.</div>
                                
                                <div id="final-stats-container" class="space-y-3 h-[60vh] overflow-y-auto border border-gray-200 rounded-xl p-4 bg-gray-50"></div>

                                <div class="flex gap-3 pt-4 border-t mt-4">
                                    <button type="button" onclick="resetNewMatchForm()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Cancelar</button>
                                    <button type="submit" class="flex-1 px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 font-medium font-bold text-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">üíæ GUARDAR PARTIDO</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- PARTIDOS REGISTRADOS SECTION -->
            <section id="section-partidos" class="hidden fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Partidos Registrados</h2>
                        <p class="text-gray-500 text-sm">Historial de partidos con estad√≠sticas</p>
                    </div>
                    <button onclick="openAdvancedSearch()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold shadow-md flex items-center gap-2 transition-all text-sm">
                        <span>üîé</span> Buscador Avanzado
                    </button>
                </div>

                <!-- Match Filters -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Competici√≥n</label>
                            <select id="filter-competition" onchange="renderMatches()" class="w-full px-3 py-2 border rounded-lg">
                                <option value="">Todas las competiciones</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Condici√≥n</label>
                            <select id="filter-venue" onchange="renderMatches()" class="w-full px-3 py-2 border rounded-lg">
                                <option value="">Todos</option>
                                <option value="local">Local</option>
                                <option value="visitante">Visitante</option>
                                <option value="neutral">Campo Neutral</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Resultado</label>
                            <select id="filter-result" onchange="renderMatches()" class="w-full px-3 py-2 border rounded-lg">
                                <option value="">Todos</option>
                                <option value="victoria">Victorias</option>
                                <option value="empate">Empates</option>
                                <option value="derrota">Derrotas</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-100 p-3 rounded-lg mb-4 flex flex-col md:flex-row gap-3 items-center border border-gray-200">
                                    <div class="flex-1 w-full">
                                        <input type="text" id="filter-rival" placeholder="üîç Buscar rival (ej: Bar√ßa)" 
                                               class="w-full px-3 py-2 rounded border border-gray-300 text-sm focus:ring-2 focus:ring-blue-500"
                                               onkeyup="applyMatchFilters()">
                                    </div>
                                    <div class="w-full md:w-auto">
                                        <select id="filter-competition" class="w-full px-3 py-2 rounded border border-gray-300 text-sm" onchange="applyMatchFilters()">
                                            <option value="all">Todas las Competiciones</option>
                                            <option value="Liga">Liga</option>
                                            <option value="Champions">Champions League</option>
                                            <option value="Copa">Copa del Rey</option>
                                            <option value="Supercopa">Supercopa</option>
                                        </select>
                                    </div>
                                    <div class="w-full md:w-auto">
                                        <select id="filter-result" class="w-full px-3 py-2 rounded border border-gray-300 text-sm" onchange="applyMatchFilters()">
                                            <option value="all">Todos los resultados</option>
                                            <option value="victoria">‚úÖ Victorias</option>
                                            <option value="empate">‚ûñ Empates</option>
                                            <option value="derrota">‚ùå Derrotas</option>
                                        </select>
                                    </div>
                                </div>
                <div id="matches-list" class="space-y-4"></div>
                <div id="no-matches" class="hidden text-center py-12">
                    <div class="text-6xl mb-4">üìÖ</div>
                    <h3 class="text-xl font-medium text-gray-600">No hay partidos registrados</h3>
                    <p class="text-gray-500">Ve a "üìÖ Calendario" y haz clic en un partido pasado para registrarlo</p>
                </div>
            </section>

            <!-- COMPARATOR SECTION -->
            <section id="section-comparador" class="hidden fade-in">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">‚öîÔ∏è Duelo de Estad√≠sticas</h2>
                    <p class="text-gray-500 text-sm">Compara el rendimiento detallado de dos jugadores</p>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                    
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-8 bg-gray-50 p-4 rounded-xl border border-gray-100">
                        <div class="w-full md:w-1/3">
                            <label class="block text-xs font-bold text-blue-800 uppercase mb-2 tracking-wider">Jugador 1</label>
                            <select id="radar-p1" onchange="updateComparatorChart()" class="w-full p-3 border-2 border-blue-200 rounded-xl font-bold text-gray-700 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 bg-white transition-all"></select>
                        </div>
                        
                        <div class="flex flex-col items-center justify-center">
                            <span class="text-3xl font-black text-slate-200">VS</span>
                        </div>

                        <div class="w-full md:w-1/3">
                            <label class="block text-xs font-bold text-red-800 uppercase mb-2 tracking-wider">Jugador 2</label>
                            <select id="radar-p2" onchange="updateComparatorChart()" class="w-full p-3 border-2 border-red-200 rounded-xl font-bold text-gray-700 focus:border-red-500 focus:ring-4 focus:ring-red-100 bg-white transition-all"></select>
                        </div>
                    </div>

                    <div class="flex flex-col lg:flex-row gap-8 items-center">
                        
                        <div class="flex-1 w-full relative h-[400px] flex items-center justify-center p-4">
                            <canvas id="chart-radar-vs"></canvas>
                        </div>

                        <div class="w-full lg:w-1/3 bg-slate-50 p-6 rounded-2xl border border-slate-200 shadow-inner">
                            <h4 class="text-xs font-bold text-slate-500 uppercase mb-6 text-center tracking-widest border-b border-slate-200 pb-2">Comparativa Directa</h4>
                            <div id="radar-stats-table" class="space-y-4 text-sm">
                                <p class="text-center text-gray-400 italic">Selecciona dos jugadores para comparar</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

           <!-- STATS SECTION --> 
            <section id="section-stats" class="hidden fade-in">
            <div class="mb-6">
    
    <div class="flex flex-wrap gap-2 mb-4 border-b border-slate-200 pb-2">
        <button onclick="showStatCategory('team')" id="cat-btn-team" class="px-4 py-2 rounded-lg font-bold text-slate-600 hover:bg-slate-100 transition-all text-sm flex items-center gap-2 category-btn active-category">
            üìä EQUIPO
        </button>
        <button onclick="showStatCategory('players')" id="cat-btn-players" class="px-4 py-2 rounded-lg font-bold text-slate-600 hover:bg-slate-100 transition-all text-sm flex items-center gap-2 category-btn">
            üë§ PROTAGONISTAS
        </button>
        <button onclick="showStatCategory('rivals')" id="cat-btn-rivals" class="px-4 py-2 rounded-lg font-bold text-slate-600 hover:bg-slate-100 transition-all text-sm flex items-center gap-2 category-btn">
            ‚öîÔ∏è RIVALES
        </button>
        <button onclick="showStatCategory('history')" id="cat-btn-history" class="px-4 py-2 rounded-lg font-bold text-slate-600 hover:bg-slate-100 transition-all text-sm flex items-center gap-2 category-btn">
            üèõÔ∏è CLUB E HISTORIA
        </button>
    </div>

    <div class="bg-slate-50 p-3 rounded-xl border border-slate-200">
        
        <div id="cat-content-team" class="category-content flex flex-wrap gap-2">
            <button onclick="switchStatsTab('general')" id="btn-stats-general" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors active">
                üìà General
            </button>
            <button onclick="switchStatsTab('advanced')" id="btn-stats-advanced" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üß† Avanzado / T√°ctico
            </button>
        </div>

        <div id="cat-content-players" class="category-content hidden flex flex-wrap gap-2">
            <button onclick="switchStatsTab('coaches')" id="btn-stats-coaches" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üëî Entrenadores
            </button>
            <button onclick="switchStatsTab('goalkeepers')" id="btn-stats-goalkeepers" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üß§ Porteros
            </button>
            <button onclick="switchStatsTab('cantera')" id="btn-stats-cantera" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üéì La F√°brica
            </button>
        </div>

        <div id="cat-content-rivals" class="category-content hidden flex flex-wrap gap-2">
            <button onclick="switchStatsTab('h2h')" id="btn-stats-h2h" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üÜö Historial H2H
            </button>
        </div>

        <div id="cat-content-history" class="category-content hidden flex flex-wrap gap-2">
            <button onclick="openTrophyRoom()" class="px-3 py-1.5 rounded-md text-sm font-medium bg-amber-100 text-amber-800 border border-amber-200 shadow-sm hover:bg-amber-200 transition-colors flex items-center gap-1">
                üèÜ Trofeos
            </button>
            <button onclick="switchStatsTab('mvp')" id="btn-stats-mvp" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                ‚≠ê Muro de la Fama
            </button>
            <button onclick="switchStatsTab('awards')" id="btn-stats-awards" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üèÖ Gala de Premios
            </button>
            <button onclick="switchStatsTab('records')" id="btn-stats-records" class="stats-subtab px-3 py-1.5 rounded-md text-sm font-medium bg-white border border-slate-200 shadow-sm hover:text-blue-600 transition-colors">
                üìú Libro de R√©cords
            </button>
        </div>

    </div>
    </div>            
                
                <!-- SUB-SECTION: GENERAL -->
                        <div id="stats-general" class="stats-content fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b">
                         <h3 class="text-lg font-bold text-gray-800">Estad√≠sticas Generales</h3>

                    <div class="flex gap-2">
                  <button onclick="exportStats()" class="bg-white text-gray-600 border border-gray-300 hover:bg-gray-50 font-bold py-2 px-4 rounded-lg shadow-sm flex items-center gap-2 transition-all text-sm">
                            üì• Exportar CSV
                         </button>

                        <button onclick="showTab('comparador')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 shadow transition transform hover:scale-105">
                              üÜö Comparador VS
                        </button>
                        <button onclick="generateSeasonYearbook()" class="w-full py-3 bg-gradient-to-r from-purple-900 to-indigo-900 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 hover:scale-[1.02] transition-transform border border-purple-500/30">
                         üìö Generar Anuario PDF
                        </button>
                         </div> </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-8 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-slate-700 to-slate-800 rounded-xl p-4 text-white">
                            <p class="text-slate-300 text-sm">Partidos</p>
                            <p id="stat-total-matches" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white">
                            <p class="text-green-100 text-sm">Victorias</p>
                            <p id="stat-wins" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl p-4 text-white">
                            <p class="text-amber-100 text-sm">Empates</p>
                            <p id="stat-draws" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white">
                            <p class="text-red-100 text-sm">Derrotas</p>
                            <p id="stat-losses" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl p-4 text-white">
                            <p class="text-emerald-100 text-sm">Goles Favor</p>
                            <p id="stat-total-goals" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-rose-500 to-rose-600 rounded-xl p-4 text-white">
                            <p class="text-rose-100 text-sm">Goles Contra</p>
                            <p id="stat-total-goals-against" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white">
                            <p class="text-purple-100 text-sm">Asistencias</p>
                            <p id="stat-total-assists" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 text-white">
                            <p class="text-indigo-100 text-sm">Jugadores</p>
                            <p id="stat-total-players" class="text-3xl font-bold">0</p>
                        </div>
                    </div>
                    <div class="mb-8">
                        <h4 class="font-bold text-gray-700 text-xl mb-4 flex items-center gap-2">
                            üåü El Once de Gala <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">Basado en Nota Media</span>
                        </h4>
                        
                        <div class="bg-emerald-600 rounded-xl shadow-lg border-4 border-emerald-700 p-4 relative h-[600px] w-full max-w-3xl mx-auto overflow-hidden">
                            
                            <div class="absolute inset-0 opacity-20 pointer-events-none">
                                <div class="w-full h-full bg-[linear-gradient(to_bottom,transparent_50%,rgba(0,0,0,0.1)_50%),linear-gradient(to_right,rgba(0,0,0,0.05)_50%,transparent_50%)] bg-[length:100%_100px,100px_100%]"></div>
                                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-3/5 h-1/6 border-2 border-white bg-transparent"></div>
                                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-2/5 h-[6%] border-2 border-white bg-transparent"></div>
                                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 border-2 border-white rounded-full"></div>
                                <div class="absolute top-1/2 left-0 w-full h-0.5 bg-white/50"></div>
                                <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-3/5 h-1/6 border-2 border-white bg-transparent"></div>
                                <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/5 h-[6%] border-2 border-white bg-transparent"></div>
                            </div>

                            <div id="best-xi-container" class="relative w-full h-full z-10">
                                </div>

                        </div>
                    </div>
                   
                    <div class="mb-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h4 class="font-bold text-gray-700 text-xl mb-2">üìä Cuadrante de Rendimiento</h4>
                        <p class="text-xs text-gray-500 mb-6">Relaci√≥n entre Cantidad de Minutos y Calidad de Juego</p>
                        
                        <div class="w-full h-[400px]">
                            <canvas id="chart-scatter-performance"></canvas>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2 mt-4 text-xs text-center opacity-70">
                            <div class="p-2 bg-yellow-50 text-yellow-700 rounded border border-yellow-100">üíé Juegan poco / Rinden mucho</div>
                            <div class="p-2 bg-green-50 text-green-700 rounded border border-green-100">üåü Estrellas (Juegan mucho / Rinden bien)</div>
                            <div class="p-2 bg-gray-50 text-gray-600 rounded border border-gray-100">üìâ Necesitan mejorar</div>
                            <div class="p-2 bg-red-50 text-red-600 rounded border border-red-100">‚ö†Ô∏è Fatiga (Juegan mucho / Rinden bajo)</div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg border-t-4 border-blue-500 p-6 mb-8 fade-in">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
            üè∞ La Fortaleza vs ‚úàÔ∏è El Viajero
        </h3>
        <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">
            Rendimiento Local vs Visitante
        </span>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="col-span-1 flex flex-col justify-center space-y-4">
            
            <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-bold text-slate-700 flex items-center gap-2">üè† EN CASA</span>
                    <span id="home-points-display" class="text-sm font-bold text-blue-600">0 Puntos</span>
                </div>
                <div class="grid grid-cols-3 text-center gap-2 text-sm">
                    <div class="bg-white p-2 rounded border shadow-sm">
                        <div class="text-xs text-gray-500">Partidos</div>
                        <div id="home-matches" class="font-bold text-lg">0</div>
                    </div>
                    <div class="bg-white p-2 rounded border shadow-sm">
                        <div class="text-xs text-green-600">Victorias</div>
                        <div id="home-wins" class="font-bold text-lg text-green-700">0</div>
                    </div>
                    <div class="bg-white p-2 rounded border shadow-sm">
                        <div class="text-xs text-blue-500">Goles</div>
                        <div id="home-goals" class="font-bold text-lg text-blue-700">0</div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center -my-2 relative z-10">
                <span class="bg-white text-gray-400 font-bold text-xs border rounded-full px-2 py-1 shadow-sm">VS</span>
            </div>

            <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-bold text-slate-700 flex items-center gap-2">‚úàÔ∏è FUERA</span>
                    <span id="away-points-display" class="text-sm font-bold text-indigo-600">0 Puntos</span>
                </div>
                <div class="grid grid-cols-3 text-center gap-2 text-sm">
                    <div class="bg-white p-2 rounded border shadow-sm">
                        <div class="text-xs text-gray-500">Partidos</div>
                        <div id="away-matches" class="font-bold text-lg">0</div>
                    </div>
                    <div class="bg-white p-2 rounded border shadow-sm">
                        <div class="text-xs text-green-600">Victorias</div>
                        <div id="away-wins" class="font-bold text-lg text-green-700">0</div>
                    </div>
                    <div class="bg-white p-2 rounded border shadow-sm">
                        <div class="text-xs text-indigo-500">Goles</div>
                        <div id="away-goals" class="font-bold text-lg text-indigo-700">0</div>
                    </div>
                </div>
            </div>

        </div>

        <div class="col-span-1 lg:col-span-2 relative h-64 md:h-auto min-h-[250px] bg-slate-50 rounded-xl border border-slate-100 p-2">
            <canvas id="chart-home-away"></canvas>
        </div>
    </div>
    </div>
                    <!-- Stats Filters -->
                    <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-100">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Competici√≥n</label>
                                <select id="stats-filter-competition" onchange="renderStats()" class="w-full px-3 py-2 border rounded-lg bg-white">
                                    <option value="">Todas las competiciones</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Estado del Jugador</label>
                                <select id="stats-filter-status" onchange="renderStats()" class="w-full px-3 py-2 border rounded-lg bg-white">
                                    <option value="">Todos</option>
                                    <option value="Activo">Solo Activos</option>
                                    <option value="Inactivo">Solo Inactivos</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Table -->
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                        <div class="p-4 border-b bg-gray-50">
                            <h3 class="font-semibold text-gray-800">Rendimiento Individual</h3>
                            <p class="text-xs text-gray-500 mt-1">Haz clic en los encabezados para ordenar.</p>
                        </div>
                        <div class="table-container">
                            <table class="w-full">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b select-none sticky top-0 z-10">
    <tr>
        <th class="px-4 py-3 text-left text-xs font-semibold uppercase sortable" onclick="handleSort('name')" id="th-name">Jugador</th>
        
        <th id="th-matchesPlayed" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('matchesPlayed')" title="Partidos Jugados">PJ</th>
        
        <th id="th-starts" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable text-indigo-600" onclick="handleSort('starts')" title="Partidos como Titular">TIT</th>

        <th id="th-avgRating" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('avgRating')" title="Nota Media">Nota</th>
        <th id="th-goals" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable text-emerald-600" onclick="handleSort('goals')" title="Goles Totales">Gol</th>
        <th id="th-gPer90" class="px-2 py-3 text-center text-xs font-semibold uppercase sortable text-blue-500" onclick="handleSort('gPer90')" title="Goles cada 90 min">G/90'</th>
        <th id="th-assists" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('assists')" title="Asistencias Totales">Asis</th>
        <th id="th-aPer90" class="px-2 py-3 text-center text-xs font-semibold uppercase sortable text-blue-500" onclick="handleSort('aPer90')" title="Asistencias cada 90 min">A/90'</th>
        <th id="th-ga" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('ga')" title="Goles + Asistencias">G+A</th>
        <th id="th-gaPer90" class="px-2 py-3 text-center text-xs font-semibold uppercase sortable text-purple-600" onclick="handleSort('gaPer90')" title="Producci√≥n (G+A) cada 90 min">G+A/90'</th>
        <th id="th-minutes" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable text-gray-600" onclick="handleSort('minutes')" title="Minutos Totales">Min</th>
        <th id="th-minPerMatch" class="px-2 py-3 text-center text-xs font-semibold uppercase sortable text-gray-500" onclick="handleSort('minPerMatch')" title="Promedio Minutos por Partido">Min/P</th>
        <th id="th-mvpCount" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('mvpCount')" title="MVPs Ganados">MVP</th>
        <th id="th-wins" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable text-green-600" onclick="handleSort('wins')" title="Victorias">V</th>
        <th id="th-draws" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable text-amber-600" onclick="handleSort('draws')" title="Empates">E</th>
        <th id="th-losses" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable text-red-600" onclick="handleSort('losses')" title="Derrotas">D</th>
        <th id="th-yellowCards" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('yellowCards')" title="Amarillas">üü®</th>
        <th id="th-redCards" class="px-4 py-3 text-center text-xs font-semibold uppercase sortable" onclick="handleSort('redCards')" title="Rojas">üü•</th>
    </tr>
    </thead>
                                <tbody id="stats-table-body"></tbody>
                            </table>
                        </div>
                        <div id="no-stats" class="hidden text-center py-8 text-gray-500">
                            No hay estad√≠sticas disponibles.
                        </div>
                    </div>
                </div>

                <!-- SUB-SECTION: ADVANCED -->
                <div id="stats-advanced" class="stats-content hidden fade-in space-y-8">
    
    

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-4">
            <div>
                <h4 class="font-bold text-gray-800 text-lg">‚öîÔ∏è Guerra de L√≠neas</h4>
                <p class="text-xs text-gray-500">Rendimiento por l√≠neas (Defensa vs Medio vs Delantera)</p>
            </div>
            <div class="flex gap-4 text-xs font-medium text-gray-500">
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span><span id="legend-def-val">Defensa</span></div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-emerald-500"></span><span id="legend-mid-val">Medio</span></div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-rose-500"></span><span id="legend-fwd-val">Delantera</span></div>
            </div>
        </div>
        <div class="w-full h-[350px] relative">
            <canvas id="chart-line-wars"></canvas>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h4 class="font-bold text-gray-800 text-lg mb-4 flex items-center gap-2">
            üìä Histograma de Rigurosidad 
            <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">Distribuci√≥n de notas</span>
        </h4>
        <div class="h-[250px] w-full relative">
            <canvas id="chart-rating-histogram"></canvas>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h4 class="font-bold text-gray-800 text-lg mb-4">üèÜ Tier List de la Temporada</h4>
        <div id="tier-list-container" class="space-y-2"></div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    
    <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-100 relative">
        <h3 class="text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
            <span>üç©</span> ADN del Equipo (Goles/Posici√≥n)
        </h3>
        <div class="relative h-64 w-full">
            <canvas id="chart-goals-position"></canvas>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-4 border border-slate-100 relative">
        <h3 class="text-sm font-bold text-slate-700 mb-4 flex items-center gap-2">
            <span>‚è±Ô∏è</span> Zona Cesarini (¬øCu√°ndo marcamos?)
        </h3>
        <div class="relative h-64 w-full">
            <canvas id="chart-goals-minutes"></canvas>
        </div>
    </div>
    </div>
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                            <div>
                                <h4 class="font-bold text-gray-800 text-lg">üç© El Rosco de la Carga</h4>
                                <p class="text-xs text-gray-500">Distribuci√≥n de minutos jugados (¬øQui√©n est√° "quemado"?)</p>
                            </div>
                        </div>
                        <div class="flex flex-col md:flex-row items-center gap-8">
                            <div class="w-full md:w-1/2 h-[300px] relative">
                                <canvas id="chart-minutes-doughnut"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                    <span class="text-xs text-gray-400 uppercase font-bold">Total Equipo</span>
                                    <span id="total-season-minutes" class="text-2xl font-black text-slate-700">0'</span>
                                </div>
                            </div>
                            
                            <div class="w-full md:w-1/2 grid grid-cols-2 gap-4">
                                <div class="bg-red-50 p-3 rounded-lg border border-red-100">
                                    <p class="text-xs text-red-500 uppercase font-bold mb-1">üî• El "Quemado"</p>
                                    <p id="min-max-player" class="font-bold text-gray-800 text-sm">-</p>
                                    <p id="min-max-value" class="text-xs text-gray-500">- min</p>
                                </div>
                                <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                                    <p class="text-xs text-blue-500 uppercase font-bold mb-1">‚ùÑÔ∏è El "Olvidado"</p>
                                    <p id="min-min-player" class="font-bold text-gray-800 text-sm">-</p>
                                    <p id="min-min-value" class="text-xs text-gray-500">- min</p>
                                </div>
                                <div class="col-span-2 bg-gray-50 p-3 rounded-lg text-xs text-gray-500 border border-gray-100">
                                    <p><strong>üí° An√°lisis:</strong> Si un trozo ocupa m√°s del 10% del gr√°fico, ese jugador es indispensable. Si no aparece o es una l√≠nea fina, necesita m√°s oportunidades.</p>
                                </div>
                            </div>
                        </div>
                        <!-- Goal Connections -->
    <div class="mt-8">
    <h3 class="text-lg font-bold text-gray-700 mb-4 flex items-center gap-2">
        <span>üîó</span> Conexiones (Asistente ‚ûî Goleador)
    </h3>
    <div id="goal-connections-container">
        <!-- El contenido se generar√° aqu√≠ con JavaScript -->
    </div>
    </div>
                    <div id="stats-visual-section" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8 mb-12 hidden">
    
                        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-4 min-h-[300px]">
                            <h3 class="font-bold text-gray-700 mb-4 px-2 border-l-4 border-indigo-500">üìà An√°lisis de Temporada</h3>
                            <div id="stats-charts-wrapper"></div> 
                        </div>
                    
                        <div class="lg:col-span-1" id="stats-goal-analysis-container">
                            </div>
                    
                    </div>
                    </div>
                    <!-- Heatmap by Position -->
                    <div class="mb-8">
                        <h4 class="font-bold text-gray-700 mb-4">Mapa de Rendimiento (Nota Media por Posici√≥n)</h4>
                        <div class="heatmap-pitch" id="heatmap-container">
                             <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Monthly Report -->
                    <div class="mb-8">
                        <h4 class="font-bold text-gray-700 mb-4">Reporte Mensual</h4>
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                             <table class="w-full text-sm">
                                <thead class="bg-slate-800 text-white">
                                    <tr>
                                        <th class="px-4 py-2 text-left">Mes</th>
                                        <th class="px-4 py-2 text-center">Partidos</th>
                                        <th class="px-4 py-2 text-center">V-E-D</th>
                                        <th class="px-4 py-2 text-center">GF / GC</th>
                                        <th class="px-4 py-2 text-center">Nota Media Equipo</th>
                                    </tr>
                                </thead>
                                <tbody id="monthly-report-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="mt-6 mb-8">
    <h3 class="text-lg font-bold text-gray-700 mb-3 border-l-4 border-indigo-500 pl-3">
        üß© Rendimiento por Esquema
    </h3>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="bg-gray-50 text-gray-500 font-bold uppercase text-xs">
                    <tr>
                        <th class="px-4 py-3">Esquema</th>
                        <th class="px-4 py-3 text-center">PJ</th>
                        <th class="px-4 py-3 text-center text-emerald-600">V</th>
                        <th class="px-4 py-3 text-center text-amber-600">E</th>
                        <th class="px-4 py-3 text-center text-red-600">D</th>
                        <th class="px-4 py-3 text-center">Efectividad</th>
                    </tr>
                </thead>
                <tbody id="formation-stats-body" class="divide-y divide-gray-100">
                    </tbody>
            </table>
        </div>
        <div id="formation-no-data" class="hidden p-8 text-center text-gray-400 text-sm">
            No hay datos suficientes para generar estad√≠sticas t√°cticas.
        </div>
    </div>
    </div>
                </div>

                <!-- SUB-SECTION: H2H -->
                <div id="stats-h2h" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 pb-2 border-b">Historial contra Rival (Head to Head)</h3>
                    <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-100">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Selecciona un rival hist√≥rico</label>
                        <select id="h2h-opponent-select" onchange="renderH2H()" class="w-full px-3 py-2 border rounded-lg bg-white">
                            <option value="">Selecciona rival...</option>
                        </select>
                    </div>
                    <div id="h2h-content" class="hidden space-y-6">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div id="stats-mvp" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6">
                    <div class="bg-gradient-to-r from-amber-500 to-orange-600 rounded-xl shadow-lg p-8 text-white text-center mb-8 relative overflow-hidden">
                        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                        <h3 class="text-3xl font-black mb-2 relative z-10">üèÜ EL MURO DE LA FAMA</h3>
                        <p class="text-amber-100 text-lg relative z-10">Los h√©roes de cada jornada</p>
                    </div>

                    <div class="flex justify-end mb-4">
                        <select id="mvp-filter-comp" onchange="renderMVPGallery()" class="px-4 py-2 border border-gray-200 rounded-lg bg-white text-sm shadow-sm focus:ring-2 focus:ring-amber-500 outline-none">
                            <option value="">Todas las competiciones</option>
                            </select>
                    </div>

                    <div id="mvp-gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        </div>
                    
                    <div id="no-mvps-msg" class="hidden text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üï∏Ô∏è</div>
                        <p>A√∫n no hay MVPs registrados. Juega partidos y elige al mejor jugador.</p>
                    </div>
                </div>
                <div id="stats-coaches" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6"></div>
                <div id="stats-goalkeepers" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6"></div>
                <div id="stats-cantera" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6"></div>
                <div id="stats-awards" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6"></div>
                <div id="stats-records" class="stats-content hidden fade-in bg-white rounded-xl shadow-lg border-t-4 border-indigo-500 p-6"></div>
            </section>
        </main>
    </div>

    <!-- PLAYER DETAILS & STATS MODAL -->

    <div id="player-details-modal" class="modal fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[100] hidden opacity-0 transition-opacity duration-300">
    <div class="bg-white rounded-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl m-4">
        
        <div id="player-modal-header-container" class="bg-white border-b border-gray-100 z-10 flex-none"></div>

        <div id="player-details-content" class="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-6 relative"></div>
    </div>
    </div>

    <!-- MATCH DETAIL MODAL -->
    <div id="match-detail-modal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b sticky top-0 bg-slate-800 text-white rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h3 id="match-detail-title" class="text-xl font-bold">Detalles del Partido</h3>
                    <button onclick="closeMatchDetailModal()" class="text-slate-300 hover:text-white cursor-pointer z-50 p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="match-detail-content" class="p-6"></div>
        </div>
    </div>
    <div id="edit-match-modal" class="fixed inset-0 bg-black/80 hidden z-[9999] items-center justify-center backdrop-blur-sm">
    <div id="edit-match-content" class="bg-white rounded-xl w-full max-w-6xl h-[95vh] shadow-2xl overflow-hidden relative flex flex-col">
        </div>
    </div>

    <!-- PLAYER STATUS MODAL -->
   <div id="player-status-modal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="p-6 border-b bg-slate-800 text-white rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Cambiar Estado</h3>
                    <button onclick="closePlayerStatusModal()" class="text-slate-300 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="player-status-content" class="p-6"></div>
        </div>
    </div>

    <div id="extra-round-modal" class="modal fixed inset-0 bg-black/50 items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="p-6 border-b bg-slate-800 text-white rounded-t-2xl">
                <h3 class="text-xl font-bold">Ronda Adicional</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-700 mb-4">Se ha terminado la fase regular. Seg√∫n tu posici√≥n en la tabla:</p>
                <p class="font-bold text-lg text-slate-800 mb-6">¬øDebe jugarse la ronda extra (Play-offs / Eliminatoria previa)?</p>
                
                <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-6 flex items-start gap-3">
                    <input type="checkbox" id="chk-play-extra" class="w-5 h-5 text-amber-600 mt-0.5">
                    <div>
                        <label for="chk-play-extra" class="font-bold text-amber-800 cursor-pointer">S√≠, jugar ronda extra</label>
                        <p class="text-xs text-amber-700">Marca esto si has quedado entre la posici√≥n 9 y 24 (Masculino) o necesitas jugar ronda previa (Femenino).</p>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button onclick="confirmExtraRound()" class="flex-1 px-4 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 font-medium">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="player-selector-modal" class="modal fixed inset-0 bg-black/80 items-center justify-center p-4 backdrop-blur-sm" style="z-index: 9999 !important;">
        <div class="bg-white rounded-xl w-full max-w-md shadow-2xl overflow-hidden flex flex-col max-h-[80vh] relative z-[10000]">
            <div class="p-4 border-b bg-slate-900 text-white flex justify-between items-center">
                <h3 class="font-bold">Seleccionar Jugador</h3>
                <button onclick="closePlayerSelector()" class="text-gray-400 hover:text-white text-xl font-bold">‚úï</button>
            </div>
            
            <div class="p-3 bg-gray-50 border-b">
                <input type="text" id="player-selector-search" 
                       onkeyup="filterSelectorList()" 
                       onkeydown="handleSelectorKey(event)"
                       placeholder="üîç Buscar jugador (ej: Roc√≠o, Vini...)" 
                       class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800">
            </div>

            <div id="player-selector-list" class="overflow-y-auto p-2 space-y-1 flex-1 bg-white">
                </div>
            
            <div class="p-3 border-t bg-gray-50 text-center">
                <button onclick="selectPlayerForSlot(null)" class="text-red-500 text-sm font-bold hover:underline py-2 w-full border border-red-100 rounded hover:bg-red-50">
                    üóëÔ∏è Dejar posici√≥n vac√≠a
                </button>
            </div>
        </div>
    </div>

    <div id="trophy-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden">
        <div class="bg-white w-full max-w-5xl h-[90vh] rounded-xl shadow-2xl overflow-hidden flex flex-col m-4">
            <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-amber-50 to-white">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üèÜ</span>
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Sala de Trofeos</h2>
                        <p class="text-xs text-gray-500 font-medium">Logros desbloqueados: <span id="trophy-count" class="text-amber-600 font-bold">0/0</span></p>
                    </div>
                </div>
                <button onclick="closeTrophyRoom()" class="text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto bg-slate-50 p-4">
                <div id="trophy-container" class="trophy-grid"></div>
            </div>
        </div>
    </div>

        <div id="minute-modal" class="modal fixed inset-0 z-[99999] hidden flex items-center justify-center" style="z-index: 99999 !important;">
    <div class="absolute inset-0 bg-black bg-opacity-60 transition-opacity backdrop-blur-sm" onclick="closeMinuteModal()"></div>
    
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm m-4 relative z-[100000] overflow-hidden border border-gray-200 h-auto">
        <div class="bg-slate-800 px-4 py-3 border-b border-slate-700 flex justify-between items-center">
            <h3 class="font-bold text-white flex items-center gap-2">
                <span>‚è±Ô∏è</span> 
                <span id="minute-modal-title">Registrar Minutos</span>
            </h3>
            <button onclick="closeMinuteModal()" class="text-gray-400 hover:text-white font-bold text-xl">&times;</button>
        </div>
        <div class="p-5">
            <p class="text-xs text-gray-500 mb-4 font-medium">
                Introduce los minutos separados por comas.
            </p>
            <input type="text" id="minute-input-field" 
                   class="w-full border-2 border-gray-200 rounded-lg px-3 py-3 text-xl font-mono text-center font-bold text-slate-700 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 outline-none transition-all placeholder-gray-300" 
                   placeholder="Ej: 15, 67" autocomplete="off">
            <div class="flex gap-2 mt-4 justify-center">
                <button onclick="addMinuteToInput('45')" class="px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-xs font-bold text-gray-600">45'</button>
                <button onclick="addMinuteToInput('90')" class="px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-xs font-bold text-gray-600">90'</button>
                <button onclick="addMinuteToInput('120')" class="px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-xs font-bold text-gray-600">120'</button>
                <button onclick="addMinuteToInput('+')" class="px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100 text-xs font-bold">+</button>
            </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 border-t border-gray-100 flex justify-end gap-2">
            <button onclick="closeMinuteModal()" class="px-4 py-2 text-sm text-gray-600 font-bold hover:bg-gray-200 rounded">Cancelar</button>
            <button onclick="saveMinutesFromModal()" class="px-4 py-2 text-sm bg-indigo-600 text-white rounded font-bold hover:bg-indigo-700 shadow-lg transform active:scale-95 transition-all">‚úÖ Guardar</button>
        </div>
    </div>
    </div>

    <!-- ADVANCED SEARCH MODAL -->
    <div id="advanced-search-modal" class="modal fixed inset-0 bg-black/80 items-center justify-center z-50 p-4 hidden" style="z-index: 10000;">
        <div class="bg-white rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden transform transition-all">
            <div class="p-5 border-b bg-slate-900 text-white flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">üîé Buscador Avanzado (Data Mining)</h3>
                <button onclick="closeAdvancedSearch()" class="text-slate-400 hover:text-white font-bold text-xl">‚úï</button>
            </div>
            <div class="p-6 bg-gray-50 space-y-4 max-h-[70vh] overflow-y-auto">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Competici√≥n</label>
                        <select id="adv-search-comp" class="w-full p-2 border rounded-lg text-sm bg-white focus:ring-2 focus:ring-indigo-500 outline-none">
                            <option value="">Todas</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Rival (contiene)</label>
                        <input type="text" id="adv-search-rival" class="w-full p-2 border rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Ej: Bar√ßa">
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                    <h4 class="text-sm font-bold text-indigo-600 mb-3 border-b pb-2 flex items-center gap-2">üë§ Filtros de Jugador</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Jugador</label>
                            <select id="adv-search-player" class="w-full p-2 border rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="">Cualquiera</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Condici√≥n</label>
                            <select id="adv-search-condition" class="w-full p-2 border rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="played">Jug√≥ el partido</option>
                                <option value="starter">Fue Titular</option>
                                <option value="sub">Sali√≥ del Banquillo</option>
                                <option value="goal">Marc√≥ Gol</option>
                                <option value="assist">Dio Asistencia</option>
                                <option value="mvp">Fue MVP</option>
                                <option value="yellow">Tarjeta Amarilla</option>
                                <option value="red">Tarjeta Roja</option>
                                <option value="rating_8">Nota >= 8.0</option>
                                <option value="rating_9">Nota >= 9.0</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Resultado</label>
                        <select id="adv-search-outcome" class="w-full p-2 border rounded-lg text-sm bg-white"><option value="">Cualquiera</option><option value="victoria">Victoria</option><option value="empate">Empate</option><option value="derrota">Derrota</option></select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Local/Visitante</label>
                        <select id="adv-search-venue" class="w-full p-2 border rounded-lg text-sm bg-white"><option value="">Cualquiera</option><option value="local">Local</option><option value="visitante">Visitante</option></select>
                    </div>
                     <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Porter√≠a a Cero</label>
                        <select id="adv-search-cleansheet" class="w-full p-2 border rounded-lg text-sm bg-white"><option value="">Indiferente</option><option value="yes">S√≠ (0 Goles en contra)</option><option value="no">No (Encajamos gol)</option></select>
                    </div>
                </div>

            </div>
            <div class="p-4 bg-white border-t flex justify-end gap-3">
                <button onclick="closeAdvancedSearch()" class="px-4 py-2 text-gray-500 font-bold hover:bg-gray-100 rounded-lg transition-colors">Cancelar</button>
                <button onclick="executeAdvancedSearch()" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-lg flex items-center gap-2 transition-transform active:scale-95"><span>üîç</span> Buscar</button>
            </div>
        </div>
    </div>

    <!-- BOT√ìN VOLVER ARRIBA -->
    <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="fixed bottom-6 right-6 bg-slate-800 text-white p-3 rounded-full shadow-lg z-40 hidden hover:bg-slate-700 transition-all transform hover:scale-110 border-2 border-white/20">
        ‚¨ÜÔ∏è
    </button>

    <!-- LOGIN MODAL (Moved to end of body) -->
    <div id="login-modal" class="modal fixed inset-0 bg-black/80 items-center justify-center z-[10000] hidden backdrop-blur-sm">
        <div class="bg-white rounded-xl w-full max-w-sm p-6 shadow-2xl m-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Acceso Administrador</h3>
                <button id="btn-close-login" class="text-gray-400 hover:text-gray-600">‚úï</button>    
            </div>
            <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="login-email" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                    <input type="password" id="login-password" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <button type="submit" class="w-full py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition">Entrar</button>
            </form>
            <div id="login-user-info" class="hidden mt-4 pt-4 border-t text-center">
                <p class="text-sm text-gray-600 mb-2">Sesi√≥n iniciada como: <span id="user-email-display" class="font-bold"></span></p>
                <button onclick="handleLogout()" class="text-sm text-red-600 hover:underline font-medium">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </div>

<script src="main.js" defer></script>

</body>
</html>    